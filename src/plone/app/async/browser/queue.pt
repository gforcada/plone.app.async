<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xml:lang="en" lang="en"
      metal:use-macro="context/prefs_main_template/macros/master"
      i18n:domain="plone">

<body>

<div metal:fill-slot="prefs_configlet_main">

    <h1 class="documentFirstHeading">Job Queue</h1>

    <p class="discreet">Manage jobs queued for asynchronous processing.</p>


    <form class="enableFormTabbing">
      <fieldset tal:define="jobs view/queued_jobs">
        <legend>Queued (<span tal:replace="python:len(jobs)"/>)</legend>
        <p tal:condition="not:jobs">There are no queued jobs.</p>
        <tal:jobs metal:use-macro="template/macros/job_listing" />
        <a href="http://localhost:8080/Plone/@@queue-job">Add job</a>
      </fieldset>

      <fieldset tal:define="jobs view/active_jobs">
        <legend>Active (<span tal:replace="python:len(jobs)"/>)</legend>
        <p tal:condition="not:jobs">There are no active jobs.</p>
        <tal:jobs metal:use-macro="template/macros/job_listing" />
      </fieldset>
            
      <fieldset tal:define="jobs view/dead_jobs">
        <legend>Aborted (<span tal:replace="python:len(jobs)"/>)</legend>
        <p tal:condition="not:jobs">There are no aborted jobs.</p>
        <tal:jobs metal:use-macro="template/macros/job_listing" />
      </fieldset>

      <fieldset tal:define="jobs view/completed_jobs">
        <legend>Completed (<span tal:replace="python:len(jobs)"/>)</legend>
        <p tal:condition="not:jobs">There are no completed jobs.</p>
        <tal:jobs metal:use-macro="template/macros/job_listing" />
      </fieldset>
    </form>

</div>

</body>
</html>

<metal:block metal:define-macro="job_listing">
  <table class="listing" tal:condition="jobs|nothing">
    <tr>
      <th>Job</th>
      <th>Status</th>
    </tr>
    <tr tal:repeat="job jobs">
      <td>
        <div><strong tal:content="python:view.custom_repr(job.callable)" /></div>
        <div>Args: <span tal:replace="python:view.format_args(job)"/></div>
      </td>
      <td>
        <div tal:content="python:view.format_timing(job)" />
        <div tal:define="progress python:view.format_progress(job)"
             tal:condition="progress" tal:content="structure progress"/>
        <div tal:define="failure python:view.format_failure(job)"
             tal:condition="failure" tal:content="structure failure"/>
      </td>
    </tr>
  </table>
</metal:block>
